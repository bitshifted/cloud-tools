---

name: tf-bootstrap-aws - verify and build

on:
  push:
    branches:
      - main
    paths:
      - 'tf-bootstrap-aws/**'
  pull_request:
    branches:
      - main
    paths:
      - 'tf-bootstrap-aws/**'

jobs:
  test-and-verify:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          fetch-tags: true
      - name: Install tools
        run: |
         pip install cfn-lint
         pip install checkov
      - name: Run static analysis
        run: |
            cfn-lint tf-bootstrap-aws/tf-bootstrap.yml
            checkov -d tf-bootstrap-aws/ --framework cloudformation

  release:
    needs: test-and-verify
    uses: ./.github/workflows/common-release.yaml
    with:
      tag-prefix: 'tf-bootstrap-aws-'
